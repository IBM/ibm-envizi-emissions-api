{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Getting Started\n",
    "\n",
    "This notebook provides a quick introduction to using the IBM Envizi Emissions API for calculating greenhouse gas emissions. We'll walk through the two kinds of sample json requests that the APIs accept and learn how to select the appropriate format based on specific use case requirements."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## POST"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### By Factor Type\n",
    "\n",
    "IBM Envizi Emissions API uses a JSON payload structure that follows the \"What, Where, When\" pattern:\n",
    "\n",
    "- **What** (activity): what type of activity generated emissions (e.g., electricity consumption, fuel combustion)\n",
    "- **Where** (location): where the activity took place (country, region, etc.)\n",
    "- **When** (time): when the activity occurred (date, time period)\n",
    "\n",
    "Let's create a simple payload for calculating emissions from electricity consumption:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "{\n",
    "  \"activity\": {\n",
    "    \"type\": \"electricity\",\n",
    "    \"value\": 10,\n",
    "    \"unit\": \"kWh\"\n",
    "  },\n",
    "  \"location\": {\n",
    "    \"country\": \"usa\",\n",
    "    \"stateProvince\": \"new york\"\n",
    "  },\n",
    "  \"time\": {\n",
    "    \"date\": \"2025-01-04\"\n",
    "  },\n",
    "  \"includeDetails\": true\n",
    "}"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Parameters\n",
    "\n",
    "1. **Activity (What)**:\n",
    "   - `type`: The type of activity (electricity consumption)\n",
    "   - `value`: The amount of electricity consumed (10 kilowatt-hours)\n",
    "   - `unit`: The unit of measurement (kWh)\n",
    "\n",
    "2. **Location (Where)**:\n",
    "   - `country`: The country where the electricity was consumed, a mandatory parameter (USA)\n",
    "   - `stateProvince` is accepted as an optional parameter (new york)\n",
    "   - Either `stateProvince` or `powerGrid` can be supplied as an optional input in case of calculating emissions on Location API.\n",
    "   - Location is crucial as emissions factors can vary significantly by region\n",
    "\n",
    "3. **Time (When)**:\n",
    "   - `date`: The date when the electricity was consumed (January 4, 2025)\n",
    "   - This helps the API select the appropriate emissions factors for that time period\n",
    "\n",
    "4. **includeDetails**:\n",
    "   - A boolean flag that determines whether the API response includes detailed calculation information"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### By Factor ID\n",
    "\n",
    "The most significant difference in this payload is the use of `factorId` instead of the location, time and activity type. \n",
    "\n",
    "This approach:\n",
    "\n",
    "- Directly references a specific emissions factor in the IBM Envizi database\n",
    "- Bypasses the need to specify location, time, and activity type\n",
    "- Provides a deterministic way to ensure the exact same factor is used consistently\n",
    "\n",
    "Let's create a simple payload for fetching emissions associated with a unique factorID along with the unit and value parameters:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "{\n",
    "  \"activity\": {\n",
    "    \"factorId\": 29902,\n",
    "    \"unit\": \"gal\",\n",
    "    \"value\": 0.9\n",
    "  },\n",
    "  \"includeDetails\": true\n",
    "}"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "The main reason is to override the Envizi Factor Selection Algorithm (FSA) to deterministically use a factor in a calculation. \n",
    "\n",
    "This approach is valuable when you need:\n",
    "\n",
    "1. **Regulatory Compliance**: Ensure specific approved factors are used for regulatory reporting\n",
    "2. **Temporal Consistency**: Maintain the same factor across multiple reporting periods\n",
    "3. **Clear Audit Trail**: Document exactly which factors were used in calculations\n",
    "4. **Calculation Reproducibility**: Guarantee identical calculation results over time, regardless of factor database updates"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## GET"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "All endpoints allow for GET calls in addition to POST, where the name of the parameters in the POST payload are represented instead by parameters declared on the url path."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "`https://api.ibm.com/ghgemissions/run/v3/carbon/location?type=electricity&value=10&unit=kwh&country=usa&stateProvince=new%20york&date=2025-01-04&includeDetails=true`"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## includeDetails\n",
    "\n",
    "When `includeDetails` is set to `true`, the response includes critical information for audit purposes:\n",
    "\n",
    "1. **Complete Factor Set Information**: This provides auditors with:\n",
    "- The exact source of emissions factors\n",
    "- Official documentation links for verification\n",
    "- Information about the data provider's authority\n",
    "- Licensing information confirming legitimate use\n",
    "\n",
    "2. **Temporal Relevance and Version Control**: Auditors can verify:\n",
    "- The emissions factors are appropriate for the reporting period \n",
    "- The factors are the most current available \n",
    "- The data is from an authoritative source \n",
    "- When the factors will be reviewed next \n",
    "\n",
    "3. **Precise Factor Values with Geographic Specificity**: This provides:\n",
    "- The exact numerical values used for each greenhouse gas component\n",
    "- Geographic specificity (United States)\n",
    "- Unique factor identifiers (factorId) for traceability\n",
    "\n",
    "4. **Unit Conversion Transparency**: This confirms:\n",
    "- The input unit matches the factor unit\n",
    "- If any conversion was necessary, and the conversion ratio used"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "```\n",
    "{\n",
    "  \"result\": {\n",
    "    \"transactionId\": \"b8ec6b22-46b5-4107-9597-348079157127\",\n",
    "    \"totalCO2e\": 2.2284403999999998,\n",
    "    \"CO2\": 2.2212781,\n",
    "    \"CH4\": 0.0035562,\n",
    "    \"N2O\": 0.0036061,\n",
    "    \"indirectCO2e\": 0.1197581,\n",
    "    \"unit\": \"kgCO2e\",\n",
    "    \"description\": \"The electricity emissions factor used to calculate this result was obtained from the  year 2022 Managed - eGRID & US Climate Leaders factor set for the area United States and the region New York.\"\n",
    "  },\n",
    "  \"data\": {\n",
    "    \"unit\": [\n",
    "      {\n",
    "        \"name\": \"CH4(kgCO2e/unit)\"\n",
    "      },\n",
    "      {\n",
    "        \"name\": \"CO2(kgCO2e/unit)\"\n",
    "      },\n",
    "      {\n",
    "        \"name\": \"Indirect CO2e(kgCO2e/unit)\"\n",
    "      },\n",
    "      {\n",
    "        \"name\": \"N2O(kgCO2e/unit)\"\n",
    "      },\n",
    "      {\n",
    "        \"name\": \"Total CO2e(kgCO2e/unit)\",\n",
    "        \"description\": \"It equals the sum of CO2, CH4 and N2O per unit factors expressed in kg of CO2-equivalents. \"\n",
    "      }\n",
    "    ],\n",
    "    \"area\": [\n",
    "      {\n",
    "        \"internalName\": \"New York\",\n",
    "        \"standardName\": \"New York\",\n",
    "        \"name\": \"New York\",\n",
    "        \"stdCode\": \"ISO 3166-2:US-NY\"\n",
    "      }\n",
    "    ],\n",
    "    \"areaType\": [\n",
    "      {\n",
    "        \"name\": \"State\"\n",
    "      }\n",
    "    ],\n",
    "    \"factorDataTypeCategories\": [\n",
    "      {\n",
    "        \"name\": \"Other Metrics\"\n",
    "      }\n",
    "    ],\n",
    "    \"factorSet\": [\n",
    "      {\n",
    "        \"type\": \"Managed - eGRID & US Climate Leaders\",\n",
    "        \"description\": \"The eGRID & US Climate Leaders factor set combines data from three U.S. EPA sources: eGRID, US Climate Leaders, and USEEIO.\\n\\neGRID provides emissions, generation, and fuel mix data for nearly all U.S. electricity generation. It supports carbon footprinting, GHG inventories, and avoided emissions analysis.\\n\\nUS Climate Leaders offers GHG emission factors for fuels, refrigerants, waste, business travel, and distribution, updated every 1–2 years.\\n\\nUSEEIO includes spend-based emission factors for 394 commodities across 66 categories, supporting supply chain emissions analysis.\\n\\nTogether, these datasets support robust, standardized emissions modeling across energy use and procurement.\",\n",
    "        \"provider\": \"Federal Government of the United States: Environmental Protection Agency\",\n",
    "        \"sourceUrl\": \"https://www.epa.gov/egrid, https://www.epa.gov/climateleadership/ghg-emission-factors-hub, https://cfpub.epa.gov/si/si_public_record_Report.cfm?dirEntryId=349324&Lab=CESER\",\n",
    "        \"displayName\": \"eGRID & US Climate Leaders\",\n",
    "        \"license\": \"Public\",\n",
    "        \"publish\": true,\n",
    "        \"calculationOnly\": false,\n",
    "        \"descriptionShort\": \"The eGRID & US Climate Leaders factor set is a combination of the eGRID, US Climate Leaders and USEEIO data sets from the Federal Government of the United States- Environmental Protection Agency.\",\n",
    "        \"citation\": \"USEEIO\\nIngwersen, W. AND M. Li. Supply Chain Greenhouse Gas Emission Factors for US Industries and Commodities. U.S. Environmental Protection Agency, Washington, DC, EPA/600/R-20/001, 2020.\"\n",
    "      }\n",
    "    ],\n",
    "    \"factorDataTypeCode\": [\n",
    "      {\n",
    "        \"unitOfMeasure\": \"kWh\"\n",
    "      }\n",
    "    ],\n",
    "    \"factorSetVersion\": [\n",
    "      {\n",
    "        \"effectiveFrom\": \"2022-01-01\",\n",
    "        \"publishedFrom\": \"2024-01-01\",\n",
    "        \"reviewOn\": \"2025-02-01\",\n",
    "        \"year\": 2022,\n",
    "        \"factorSource\": \"Year 2022 Data: 1/30/2024.Original file name: eGrid2022_summary_tables.xlsx, tab name: Table 3.GWP source: 2014 IPCC AR5 (N2O GWP = 265, CH4 GWP = 28); Source: https://www.epa.gov/egrid; Grid Gross Loss % taken from US average value in tab name: Table 1.\"\n",
    "      }\n",
    "    ],\n",
    "    \"factorValue\": [\n",
    "      {\n",
    "        \"country\": \"United States\",\n",
    "        \"region\": \"New York\",\n",
    "        \"unit\": {\n",
    "          \"name\": \"N2O(kgCO2e/unit)\"\n",
    "        },\n",
    "        \"value\": 3.6061E-4,\n",
    "        \"factorId\": 158989\n",
    "      },\n",
    "      {\n",
    "        \"country\": \"United States\",\n",
    "        \"region\": \"New York\",\n",
    "        \"unit\": {\n",
    "          \"name\": \"Total CO2e(kgCO2e/unit)\",\n",
    "          \"description\": \"It equals the sum of CO2, CH4 and N2O per unit factors expressed in kg of CO2-equivalents. \"\n",
    "        },\n",
    "        \"value\": 0.22284404,\n",
    "        \"factorId\": 158989\n",
    "      },\n",
    "      {\n",
    "        \"country\": \"United States\",\n",
    "        \"region\": \"New York\",\n",
    "        \"unit\": {\n",
    "          \"name\": \"CO2(kgCO2e/unit)\"\n",
    "        },\n",
    "        \"value\": 0.22212781,\n",
    "        \"factorId\": 158989\n",
    "      },\n",
    "      {\n",
    "        \"country\": \"United States\",\n",
    "        \"region\": \"New York\",\n",
    "        \"unit\": {\n",
    "          \"name\": \"CH4(kgCO2e/unit)\"\n",
    "        },\n",
    "        \"value\": 3.5562E-4,\n",
    "        \"factorId\": 158989\n",
    "      },\n",
    "      {\n",
    "        \"country\": \"United States\",\n",
    "        \"region\": \"New York\",\n",
    "        \"unit\": {\n",
    "          \"name\": \"Indirect CO2e(kgCO2e/unit)\"\n",
    "        },\n",
    "        \"value\": 0.01197581,\n",
    "        \"factorId\": 158989\n",
    "      }\n",
    "    ],\n",
    "    \"factorMetaData\": [\n",
    "      {\n",
    "        \"key\": \"description\",\n",
    "        \"value\": \"2022 New York State CO2 output emission rate (489.708 lb/MWh), CH4 output emission rate (0.028 lb/MWh), N2O output emission rate (0.003 lb/MWh) converted to kg CO2e/kWh using 1 lb = 0.45359237 kg; Indirect CO2e is calculated as Total CO2e * Grid Gross Loss % / (1 - Grid Gross Loss %), with factors associated with eGRID regions using eGRID region specific GGL values, and factors associated with US state regions using the US average GGL value.\",\n",
    "        \"factorId\": 158989\n",
    "      },\n",
    "      {\n",
    "        \"key\": \"name\",\n",
    "        \"value\": \"eGRID Electricity Year 2022\",\n",
    "        \"factorId\": 158989\n",
    "      }\n",
    "    ],\n",
    "    \"unitConversion\": [\n",
    "      {\n",
    "        \"inputUnit\": \"kwh\",\n",
    "        \"unitFromDb\": \"kWh\",\n",
    "        \"conversionRatio\": \"1:1\"\n",
    "      }\n",
    "    ]\n",
    "  }\n",
    "}\n",
    "```"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
